
using System.IO;
using System.Text;

namespace KPIT_K_Foundation
{
  internal class SettingsDesignerFile
  {
    private string _fullFileNamePath;
    private string _websiteName;
    private Language _language;
    private string _server;
    private string _database;
    private string _username;
    private string _password;

    private SettingsDesignerFile()
    {
    }

    internal SettingsDesignerFile(string fullFileNamePath, string websiteName, ApplicationType appType, Language language, string server = "", string database = "", string username = "", string password = "")
    {
      this._fullFileNamePath = fullFileNamePath;
      this._websiteName = websiteName.Trim();
      this._language = language;
      this._server = server;
      this._database = database;
      this._username = username;
      this._password = password;
      if (appType == ApplicationType.WINFORMS)
        this.GenerateWinForms();
      else
        this.Generate();
    }

    private void Generate()
    {
      using (StreamWriter streamWriter = new StreamWriter(this._fullFileNamePath))
      {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.AppendLine("'------------------------------------------------------------------------------");
        stringBuilder.AppendLine("' <auto-generated>");
        stringBuilder.AppendLine("'     This code was generated by a tool.");
        stringBuilder.AppendLine("'     Runtime Version:4.0.30319.261");
        stringBuilder.AppendLine("'");
        stringBuilder.AppendLine("'     Changes to this file may cause incorrect behavior and will be lost if");
        stringBuilder.AppendLine("'     the code is regenerated.");
        stringBuilder.AppendLine("' </auto-generated>");
        stringBuilder.AppendLine("'------------------------------------------------------------------------------");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("Option Strict On");
        stringBuilder.AppendLine("Option Explicit On");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("Namespace My");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("    <Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(),  _");
        stringBuilder.AppendLine("     Global.System.CodeDom.Compiler.GeneratedCodeAttribute(\"Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator\", \"9.0.0.0\"),  _");
        stringBuilder.AppendLine("     Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)>  _");
        stringBuilder.AppendLine("    Partial Friend NotInheritable Class MySettings");
        stringBuilder.AppendLine("        Inherits Global.System.Configuration.ApplicationSettingsBase");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings), MySettings)");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("#Region \"My.Settings Auto-Save Functionality\"");
        stringBuilder.AppendLine("#If _MyType = \"WindowsForms\" Then");
        stringBuilder.AppendLine("        Private Shared addedHandler As Boolean");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        Private Shared addedHandlerLockObject As New Object");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        <Global.System.Diagnostics.DebuggerNonUserCodeAttribute(), Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)> _");
        stringBuilder.AppendLine("        Private Shared Sub AutoSaveSettings(ByVal sender As Global.System.Object, ByVal e As Global.System.EventArgs)");
        stringBuilder.AppendLine("            If My.Application.SaveMySettingsOnExit Then");
        stringBuilder.AppendLine("                My.Settings.Save()");
        stringBuilder.AppendLine("            End If");
        stringBuilder.AppendLine("        End Sub");
        stringBuilder.AppendLine("#End If");
        stringBuilder.AppendLine("#End Region");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        internal Shared ReadOnly Property [Default]() As MySettings");
        stringBuilder.AppendLine("            Get");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("#If _MyType = \"WindowsForms\" Then");
        stringBuilder.AppendLine("                   If Not addedHandler Then");
        stringBuilder.AppendLine("                        SyncLock addedHandlerLockObject");
        stringBuilder.AppendLine("                            If Not addedHandler Then");
        stringBuilder.AppendLine("                                AddHandler My.Application.Shutdown, AddressOf AutoSaveSettings");
        stringBuilder.AppendLine("                                addedHandler = True");
        stringBuilder.AppendLine("                            End If");
        stringBuilder.AppendLine("                        End SyncLock");
        stringBuilder.AppendLine("                    End If");
        stringBuilder.AppendLine("#End If");
        stringBuilder.AppendLine("                Return defaultInstance");
        stringBuilder.AppendLine("            End Get");
        stringBuilder.AppendLine("        End Property");
        stringBuilder.AppendLine("    End Class");
        stringBuilder.AppendLine("End Namespace");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("Namespace My");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("    <Global.Microsoft.VisualBasic.HideModuleNameAttribute(), _");
        stringBuilder.AppendLine("     Global.System.Diagnostics.DebuggerNonUserCodeAttribute(), _");
        stringBuilder.AppendLine("     Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute()> _");
        stringBuilder.AppendLine("    Friend Module MySettingsProperty");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        <Global.System.ComponentModel.Design.HelpKeywordAttribute(\"My.Settings\")>  _");
        stringBuilder.AppendLine("        Friend ReadOnly Property Settings() As Global." + this._websiteName + ".My.MySettings");
        stringBuilder.AppendLine("            Get");
        stringBuilder.AppendLine("                Return Global." + this._websiteName + ".My.MySettings.Default");
        stringBuilder.AppendLine("            End Get");
        stringBuilder.AppendLine("        End Property");
        stringBuilder.AppendLine("    End Module");
        stringBuilder.AppendLine("End Namespace");
        streamWriter.Write(stringBuilder.ToString());
      }
    }

    private void GenerateWinForms()
    {
      if (this._language == Language.CSharp)
      {
        this.GenerateDesignerCS();
        this.GenerateSettingsCS();
      }
      else
      {
        this.GenerateDesignerVB();
        this.GenerateSettingsVB();
      }
    }

    private void GenerateDesignerCS()
    {
      using (StreamWriter streamWriter = new StreamWriter(this._fullFileNamePath + "Settings.Designer.cs"))
      {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.AppendLine("//------------------------------------------------------------------------------");
        stringBuilder.AppendLine("// <auto-generated>");
        stringBuilder.AppendLine("//     This code was generated by a tool.");
        stringBuilder.AppendLine("//     Runtime Version:4.0.30319.34209");
        stringBuilder.AppendLine("//");
        stringBuilder.AppendLine("//     Changes to this file may cause incorrect behavior and will be lost if");
        stringBuilder.AppendLine("//     the code is regenerated.");
        stringBuilder.AppendLine("// </auto-generated>");
        stringBuilder.AppendLine("//------------------------------------------------------------------------------");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("namespace " + this._websiteName + ".Properties {");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]");
        stringBuilder.AppendLine("    [global::System.CodeDom.Compiler.GeneratedCodeAttribute(\"Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator\", \"12.0.0.0\")]");
        stringBuilder.AppendLine("    internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase {");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        internal static Settings Default {");
        stringBuilder.AppendLine("            get {");
        stringBuilder.AppendLine("                return defaultInstance;");
        stringBuilder.AppendLine("            }");
        stringBuilder.AppendLine("        }");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        [global::System.Configuration.ApplicationScopedSettingAttribute()]");
        stringBuilder.AppendLine("        [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]");
        stringBuilder.AppendLine("        [global::System.Configuration.SpecialSettingAttribute(global::System.Configuration.SpecialSetting.ConnectionString)]");
        stringBuilder.AppendLine("        [global::System.Configuration.DefaultSettingValueAttribute(\"Data Source=" + this._server + ";Initial Catalog=" + this._database + ";User ID=" + this._username + ";Password=" + this._password + "\")]");
        stringBuilder.AppendLine("        internal string " + this._database + "ConnectionString {");
        stringBuilder.AppendLine("            get {");
        stringBuilder.AppendLine("                return ((string)(this[\"" + this._database + "ConnectionString\"]));");
        stringBuilder.AppendLine("            }");
        stringBuilder.AppendLine("        }");
        stringBuilder.AppendLine("    }");
        stringBuilder.AppendLine("}");
        streamWriter.Write(stringBuilder.ToString());
      }
    }

    private void GenerateSettingsCS()
    {
      using (StreamWriter streamWriter = new StreamWriter(this._fullFileNamePath + "Settings.settings"))
      {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.AppendLine("<?xml version='1.0' encoding='utf-8'?>");
        stringBuilder.AppendLine("<SettingsFile xmlns=\"http://schemas.microsoft.com/VisualStudio/2004/01/settings\" CurrentProfile=\"(Default)\" GeneratedClassNamespace=\"" + this._websiteName + ".Properties\" GeneratedClassName=\"Settings\">");
        stringBuilder.AppendLine("  <Profiles />");
        stringBuilder.AppendLine("  <Settings>");
        stringBuilder.AppendLine("    <Setting Name=\"" + this._database + "ConnectionString\" Type=\"(Connection string)\" Scope=\"Application\">");
        stringBuilder.AppendLine("      <DesignTimeValue Profile=\"(Default)\">&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;");
        stringBuilder.AppendLine("&lt;SerializableConnectionString xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;");
        stringBuilder.AppendLine("  &lt;ConnectionString&gt;Data Source=" + this._server + ";Initial Catalog=" + this._database + ";User ID=" + this._username + ";Password=" + this._password + "&lt;/ConnectionString&gt;");
        stringBuilder.AppendLine("  &lt;ProviderName&gt;System.Data.SqlClient&lt;/ProviderName&gt;");
        stringBuilder.AppendLine("&lt;/SerializableConnectionString&gt;</DesignTimeValue>");
        stringBuilder.AppendLine("      <Value Profile=\"(Default)\">Data Source=" + this._server + ";Initial Catalog=" + this._database + ";User ID=" + this._username + ";Password=" + this._password + "</Value>");
        stringBuilder.AppendLine("    </Setting>");
        stringBuilder.AppendLine("  </Settings>");
        stringBuilder.AppendLine("</SettingsFile>");
        streamWriter.Write(stringBuilder.ToString());
      }
    }

    private void GenerateSettingsVB()
    {
      using (StreamWriter streamWriter = new StreamWriter(this._fullFileNamePath + "Settings.settings"))
      {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.AppendLine("<?xml version='1.0' encoding='utf-8'?>");
        stringBuilder.AppendLine("<SettingsFile xmlns=\"http://schemas.microsoft.com/VisualStudio/2004/01/settings\" CurrentProfile=\"(Default)\" UseMySettingsClassName=\"true\">");
        stringBuilder.AppendLine("  <Profiles>");
        stringBuilder.AppendLine("    <Profile Name=\"(Default)\" />");
        stringBuilder.AppendLine("  </Profiles>");
        stringBuilder.AppendLine("  <Settings />");
        stringBuilder.AppendLine("</SettingsFile>");
        streamWriter.Write(stringBuilder.ToString());
      }
    }

    private void GenerateDesignerVB()
    {
      using (StreamWriter streamWriter = new StreamWriter(this._fullFileNamePath + "Settings.Designer.vb"))
      {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.AppendLine("'------------------------------------------------------------------------------");
        stringBuilder.AppendLine("' <auto-generated>");
        stringBuilder.AppendLine("'     This code was generated by a tool.");
        stringBuilder.AppendLine("'     Runtime Version:4.0.30319.42000");
        stringBuilder.AppendLine("'");
        stringBuilder.AppendLine("'     Changes to this file may cause incorrect behavior and will be lost if");
        stringBuilder.AppendLine("'     the code is regenerated.");
        stringBuilder.AppendLine("' </auto-generated>");
        stringBuilder.AppendLine("'------------------------------------------------------------------------------");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("Option Strict On");
        stringBuilder.AppendLine("Option Explicit On");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("Namespace My");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("    <Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute(), _");
        stringBuilder.AppendLine("     Global.System.CodeDom.Compiler.GeneratedCodeAttribute(\"Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator\", \"11.0.0.0\"), _");
        stringBuilder.AppendLine("     Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)> _");
        stringBuilder.AppendLine("    Partial Friend NotInheritable Class MySettings");
        stringBuilder.AppendLine("        Inherits Global.System.Configuration.ApplicationSettingsBase");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        Private Shared defaultInstance As MySettings = CType(Global.System.Configuration.ApplicationSettingsBase.Synchronized(New MySettings), MySettings)");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("#Region \"My.Settings Auto-Save Functionality\"");
        stringBuilder.AppendLine("#If _MyType = \"WindowsForms\" Then");
        stringBuilder.AppendLine("        Private Shared addedHandler As Boolean");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        Private Shared addedHandlerLockObject As New Object");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        <Global.System.Diagnostics.DebuggerNonUserCodeAttribute(), Global.System.ComponentModel.EditorBrowsableAttribute(Global.System.ComponentModel.EditorBrowsableState.Advanced)> _");
        stringBuilder.AppendLine("        Private Shared Sub AutoSaveSettings(ByVal sender As Global.System.Object, ByVal e As Global.System.EventArgs)");
        stringBuilder.AppendLine("            If My.Application.SaveMySettingsOnExit Then");
        stringBuilder.AppendLine("                My.Settings.Save()");
        stringBuilder.AppendLine("            End If");
        stringBuilder.AppendLine("        End Sub");
        stringBuilder.AppendLine("#End If");
        stringBuilder.AppendLine("#End Region");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        internal Shared ReadOnly Property [Default]() As MySettings");
        stringBuilder.AppendLine("            Get");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("#If _MyType = \"WindowsForms\" Then");
        stringBuilder.AppendLine("                   If Not addedHandler Then");
        stringBuilder.AppendLine("                        SyncLock addedHandlerLockObject");
        stringBuilder.AppendLine("                            If Not addedHandler Then");
        stringBuilder.AppendLine("                                AddHandler My.Application.Shutdown, AddressOf AutoSaveSettings");
        stringBuilder.AppendLine("                                addedHandler = True");
        stringBuilder.AppendLine("                            End If");
        stringBuilder.AppendLine("                        End SyncLock");
        stringBuilder.AppendLine("                    End If");
        stringBuilder.AppendLine("#End If");
        stringBuilder.AppendLine("                Return defaultInstance");
        stringBuilder.AppendLine("            End Get");
        stringBuilder.AppendLine("        End Property");
        stringBuilder.AppendLine("    End Class");
        stringBuilder.AppendLine("End Namespace");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("Namespace My");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("    <Global.Microsoft.VisualBasic.HideModuleNameAttribute(),  _");
        stringBuilder.AppendLine("     Global.System.Diagnostics.DebuggerNonUserCodeAttribute(),  _");
        stringBuilder.AppendLine("     Global.System.Runtime.CompilerServices.CompilerGeneratedAttribute()>  _");
        stringBuilder.AppendLine("    Friend Module MySettingsProperty");
        stringBuilder.AppendLine("");
        stringBuilder.AppendLine("        <Global.System.ComponentModel.Design.HelpKeywordAttribute(\"My.Settings\")>  _");
        stringBuilder.AppendLine("        Friend ReadOnly Property Settings() As Global." + this._websiteName + ".My.MySettings");
        stringBuilder.AppendLine("            Get");
        stringBuilder.AppendLine("                Return Global." + this._websiteName + ".My.MySettings.Default");
        stringBuilder.AppendLine("            End Get");
        stringBuilder.AppendLine("        End Property");
        stringBuilder.AppendLine("    End Module");
        stringBuilder.AppendLine("End Namespace");
        streamWriter.Write(stringBuilder.ToString());
      }
    }
  }
}
